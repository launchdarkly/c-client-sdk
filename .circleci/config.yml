# This CircleCI configuration was generated by Releaser for a specific release. It is not to be used
# for regular CI builds. Be aware that rerunning this build may cause it to repeat release actions
# such as publishing to a package manager. However, it will not perform any Git actions other than
# reading the repository.
orbs:
  aws-cli: circleci/aws-cli@3.1
  win: circleci/windows@2.4.0
version: 2.1
workflows:
  release:
    jobs:
      - linux:
          context: circleci-oidc-auth
      - mac:
          context: circleci-oidc-auth
      - windows:
          context: circleci-oidc-auth
jobs:
  linux:
    docker:
      - image: ldcircleci/ld-c-sdk-ubuntu:5
    environment:
      AWS_DEFAULT_REGION: "us-east-1"
      LD_LIBRARY_FILE_PREFIX: "linux-gcc-64bit"
      LD_RELEASE_ARTIFACTS_DIR: "/tmp/releaser-artifacts"
      LD_RELEASE_BRANCH: "main"
      LD_RELEASE_CIRCLECI_TYPE: "linux"
      LD_RELEASE_DOCS_DIR: "/tmp/releaser-docs"
      LD_RELEASE_DOCS_GITHUB_PAGES: "1"
      LD_RELEASE_DOCS_TITLE: "LaunchDarkly Client-Side SDK for C/C++"
      LD_RELEASE_DRY_RUN: ""
      LD_RELEASE_FILE_BUCKET: "launchdarkly-releaser"
      LD_RELEASE_IS_PRERELEASE: ""
      LD_RELEASE_PROJECT: "c-client-sdk"
      LD_RELEASE_PROJECT_DIR: "/tmp/releaser-project"
      LD_RELEASE_PROJECT_TEMPLATE: ""
      LD_RELEASE_SECRETS_DIR: "/tmp/releaser-secrets"
      LD_RELEASE_TEMP_DIR: "/tmp/releaser-temp"
      LD_RELEASE_VERSION: "2.5.5"
    working_directory: "/tmp/releaser-project"
    steps:
      - checkout
      - aws-cli/setup:
          role-arn: arn:aws:iam::554582317989:role/circleci-project-releaser
      - run:
          name: "prepare Releaser environment"
          command: .ldrelease/circleci/linux/prepare-all.sh
      - run:
          name: "Releaser: build"
          command: .ldrelease/circleci/linux/execute.sh build .ldrelease/build.sh
      - run:
          name: "Releaser: test"
          command: .ldrelease/circleci/linux/execute.sh test .ldrelease/test.sh
      - run:
          name: "Releaser: build-docs"
          command: .ldrelease/circleci/linux/execute.sh build-docs .ldrelease/linux-build-docs.sh
      - store_artifacts:
          path: "/tmp/releaser-artifacts"
          destination: artifacts
      - store_artifacts:
          path: "/tmp/releaser-docs"
          destination: docs
  mac:
    macos:
      xcode: "12.5.1"
    environment:
      AWS_DEFAULT_REGION: "us-east-1"
      LD_LIBRARY_FILE_PREFIX: "osx-clang-64bit"
      LD_RELEASE_ARTIFACTS_DIR: "/tmp/releaser-artifacts"
      LD_RELEASE_BRANCH: "main"
      LD_RELEASE_CIRCLECI_TYPE: "mac"
      LD_RELEASE_DOCS_DIR: "/tmp/releaser-docs"
      LD_RELEASE_DOCS_GITHUB_PAGES: "1"
      LD_RELEASE_DOCS_TITLE: "LaunchDarkly Client-Side SDK for C/C++"
      LD_RELEASE_DRY_RUN: ""
      LD_RELEASE_FILE_BUCKET: "launchdarkly-releaser"
      LD_RELEASE_IS_PRERELEASE: ""
      LD_RELEASE_PROJECT: "c-client-sdk"
      LD_RELEASE_PROJECT_DIR: "/tmp/releaser-project"
      LD_RELEASE_PROJECT_TEMPLATE: ""
      LD_RELEASE_SECRETS_DIR: "/tmp/releaser-secrets"
      LD_RELEASE_TEMP_DIR: "/tmp/releaser-temp"
      LD_RELEASE_VERSION: "2.5.5"
    working_directory: "/tmp/releaser-project"
    steps:
      - checkout
      - aws-cli/setup:
          role-arn: arn:aws:iam::554582317989:role/circleci-project-releaser
      - run:
          name: "prepare Releaser environment"
          command: .ldrelease/circleci/mac/prepare-all.sh
      - run:
          name: "Releaser: prepare"
          command: .ldrelease/circleci/mac/execute.sh prepare .ldrelease/mac-prepare.sh
      - run:
          name: "Releaser: build"
          command: .ldrelease/circleci/mac/execute.sh build .ldrelease/build.sh
      - run:
          name: "Releaser: test"
          command: .ldrelease/circleci/mac/execute.sh test .ldrelease/test.sh
      - store_artifacts:
          path: "/tmp/releaser-artifacts"
          destination: artifacts
      - store_artifacts:
          path: "/tmp/releaser-docs"
          destination: docs
  windows:
    executor:
      name: win/default
      shell: bash.exe
    environment:
      AWS_DEFAULT_REGION: "us-east-1"
      LD_LIBRARY_FILE_PREFIX: "windows-vs-64bit"
      LD_RELEASE_ARTIFACTS_DIR: "c:\\Windows\\Temp\\releaser-artifacts"
      LD_RELEASE_BRANCH: "main"
      LD_RELEASE_CIRCLECI_TYPE: "windows"
      LD_RELEASE_DOCS_DIR: "c:\\Windows\\Temp\\releaser-docs"
      LD_RELEASE_DOCS_GITHUB_PAGES: "1"
      LD_RELEASE_DOCS_TITLE: "LaunchDarkly Client-Side SDK for C/C++"
      LD_RELEASE_DRY_RUN: ""
      LD_RELEASE_FILE_BUCKET: "launchdarkly-releaser"
      LD_RELEASE_IS_PRERELEASE: ""
      LD_RELEASE_PROJECT: "c-client-sdk"
      LD_RELEASE_PROJECT_DIR: "c:\\Windows\\Temp\\releaser-project"
      LD_RELEASE_PROJECT_TEMPLATE: ""
      LD_RELEASE_SECRETS_DIR: "c:\\Windows\\Temp\\releaser-secrets"
      LD_RELEASE_TEMP_DIR: "c:\\Windows\\Temp\\releaser-temp"
      LD_RELEASE_VERSION: "2.5.5"
    working_directory: "c:\\Windows\\Temp\\releaser-project"
    steps:
      - checkout
      - aws-cli/setup:
          role-arn: arn:aws:iam::554582317989:role/circleci-project-releaser
      - run:
          shell: powershell.exe
          name: "prepare Releaser environment"
          command: .ldrelease/circleci/windows/prepare-all.ps1
      - run:
          shell: powershell.exe
          name: "Releaser: build"
          command: .ldrelease/circleci/windows/execute.ps1 -step build .ldrelease/build.ps1
      - run:
          shell: powershell.exe
          name: "Releaser: test"
          command: .ldrelease/circleci/windows/execute.ps1 -step test .ldrelease/test.ps1
      - store_artifacts:
          path: "c:\\Windows\\Temp\\releaser-artifacts"
          destination: artifacts
      - store_artifacts:
          path: "c:\\Windows\\Temp\\releaser-docs"
          destination: docs
